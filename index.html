<!DOCTYPE html>
<html>
<head> 
<title>Web Map Interactions</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet-control-search/dist/leaflet-search.min.css" />
<script src="https://unpkg.com/leaflet-control-search/dist/leaflet-search.min.js"></script>

<style> 
html { height:100% } 
body { height:100%; padding: 0; margin: 0; } 
#map { width: 100%; height: 100%; }

.info {
  z-index: 1000;
  position: absolute;
  right: 10px;
  top: 40px;
  padding: 6px 8px;
  font: 14px Arial, Helvetica, sans-serif;
  text-align: right;
  background: rgba(255, 255, 255, 0.8);
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border-radius: 5px;
}

.legend {
  z-index: 1000;
  position: absolute;
  right: 20px;
  bottom: 20px;
  padding: 6px 8px;
  font: 14px Arial, Helvetica, sans-serif;
  background: rgba(255, 255, 255, 0.8);
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border-radius: 5px;
}

.legend i {
  width: 18px;
  height: 16px;
  float: left;
  margin-right: 8px;
  opacity: 0.7;
}

section {
  position: absolute;
  bottom: 0;
  left: 10px;
  width: 280px;
  margin: 20px auto;
  padding: 0 15px;
  background: rgba(256, 256, 256);
  border: 1px solid grey;
  border-radius: 3px;
  z-index: 800;
}

p { font-size: .9em; line-height: 1.5em; }

</style> 

<script src="https://unpkg.com/leaflet@1.7.0/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>

<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

</head>
<body>

<h1>Forest Cover Percentage By State</h1>
<div id='map'></div>
<div class="legend"></div>

<section>
  <h2>Forest Cover</h2>
  <p>The data was retrieved from Data.gov. This map accounts for timberland; true forest cover may be higher.</p>
  <p>Map authored by Devin Axtell</p>
</section>

<script>  

//MAP
var map = L.map('map').setView([37.8, -96], 5);

// Basemaps
var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
	maxZoom: 10
}).addTo(map);

var topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png');
var esri_sat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{x}/{y}');

var baseMaps = {
    "OpenStreetMap": osm,
    "Topo Map": topo,
    "Esri Satellite": esri_sat
};

//CHOROPLETH
var grades = [0,10,20,30,40,50,60,70,80,90,100];
var colors = chroma.scale('BuGn').colors(grades.length);

function getColor(d) {
  for (var i = 0; i < grades.length - 1; i++) {
      if (d >= grades[i] && d < grades[i+1]) return colors[i];
  }
  return colors[grades.length - 1];
}

function style(feature) { 
    return { 
        weight: 1, 
        opacity: 1, 
        color: 'grey', 
        dashArray: '2', 
        fillOpacity: 0.7, 
        fillColor: getColor(feature.properties.Forestcoverstate)
    }; 
}

//INFO BOX
var info = L.control();
info.onAdd = function () {
    this._div = L.DomUtil.create('div', 'info');
    this.update();
    return this._div;
};

info.update = function (props) {
    this._div.innerHTML = '<h4>Forest Cover %</h4>' + (props ?
        '<b>' + props.name + '</b><br>' + props.Forestcoverstate + '%'
        : 'Hover over a state');
};
info.addTo(map);

//INTERACTIONS
var geojson;

function highlightFeature(e) {
    var layer = e.target;
    layer.setStyle({
        weight: 4,
        color: '#666',
        fillOpacity: 0.5
    });
    info.update(layer.feature.properties);
    layer.bringToFront();
}

function resetHighlight(e) {
    geojson.resetStyle(e.target);
    info.update();
}

function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());
}

var searchControl = new L.Control.Search({
    layer: geojson,
    propertyName: 'NAME',  // <-- The property in your GeoJSON containing state names
    marker: false,
    moveToLocation: function(latlng, title, map) {
        map.fitBounds(latlng.layer.getBounds()); // zoom to polygon
    }
});

searchControl.addTo(map);


// POPUP CODE
function onEachFeature(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        click: zoomToFeature,
        mouseout: resetHighlight
    });

    layer.bindPopup(
        "<b>" + feature.properties.name + "</b><br>" +
        "Forest Cover: " + feature.properties.Forestcoverstate + "%"
    );
}

//LOAD GEOJSON
geojson = L.geoJson.ajax("assets/forestcover.geojson", {
    style: style,
    onEachFeature: onEachFeature
}).addTo(map);

//LEGEND
var labels = [];
for (var i = 0; i < grades.length - 1; i++) {
    labels.push('<i style="background:' + colors[i] + '"></i> ' +
                 grades[i] + ' - ' + grades[i + 1]);
}
labels.push('<i style="background:' + colors[grades.length - 1] +
            '"></i> ' + grades[grades.length - 1] + '+');

document.querySelector(".legend").innerHTML = labels.join('<br>');

//SEARCH BAR
L.Control.geocoder({ defaultMarkGeocode: false }).addTo(map);

//LAYER CONTROL 
L.control.layers(baseMaps).setPosition('bottomleft').addTo(map);

//SCALE BAR
L.control.scale().addTo(map);

map.attributionControl.addAttribution(
  'Forest Cover Data &copy; Data.gov | Map by D. Axtell'
);

</script>
</body>
</html>